<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Carlos Peralta">
<meta name="dcterms.date" content="2024-05-07">

<title>Spatial verification of snow cover with the MET tools package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="cerise_fss_nuuk_files/libs/clipboard/clipboard.min.js"></script>
<script src="cerise_fss_nuuk_files/libs/quarto-html/quarto.js"></script>
<script src="cerise_fss_nuuk_files/libs/quarto-html/popper.min.js"></script>
<script src="cerise_fss_nuuk_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cerise_fss_nuuk_files/libs/quarto-html/anchor.min.js"></script>
<link href="cerise_fss_nuuk_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cerise_fss_nuuk_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cerise_fss_nuuk_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cerise_fss_nuuk_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cerise_fss_nuuk_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spatial verification of snow cover with the MET tools package</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Carlos Peralta </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 7, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">May 7, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>First results of spatial verification with the Model Evaluation Tools <a href="https://dtcenter.org/community-code/model-evaluation-tools-met">(MET) package</a>. Data used: - CARRA1 West domain in regular lat lon grid (fraction of snow cover). - Snow cover data (probability of snow) provided by MetNorway</p>
<p>The snow cover data is interpolated to the regular grid of CARRA1 using <code>pyresample</code>.</p>
<p>The fraction skill score is calculated with the MET package <code>grid_stat</code>, using a binary dummy variable previously defined as 1 or 0 in the CARRA forecast data using the fscov variable. The threshold chosen for CARRA is 0.8, and for the MET Norway data we choose 80 %. All under these thresholds is set to 0, 1 otherwise. In this case we examine the data on the 9th of May.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> OrderedDict</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>MET_res<span class="op">=</span><span class="st">"/ec/res4/scratch/nhd/CERISE/MET_results/MET_data"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>cmap_custom <span class="op">=</span> mcolors.ListedColormap([<span class="st">'blue'</span>,<span class="st">"white"</span>, <span class="st">'red'</span>])  <span class="co"># Define a custom colormap with two colors</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#opening one file</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>ncfile <span class="op">=</span> <span class="st">"grid_stat_000000L_20150509_000000V_pairs.nc"</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>nf <span class="op">=</span> os.path.join(MET_res,ncfile)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> xr.open_dataset(nf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualization-of-the-domains-used-for-verification" class="level2">
<h2 class="anchored" data-anchor-id="visualization-of-the-domains-used-for-verification">Visualization of the domains used for verification</h2>
<p>Calculating the FSS over the whole of the Greenland domain is probably not a good idea, since the icy region in the center will mask any small scale details. Considering two regions in the verification domain: <code>FULL</code> (whole of the west CARRA domain) and a region around Nuuk (<code>NUUK</code>) Comparing here observation and forecast domains over different sizes</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>var<span class="op">=</span><span class="st">"FCST_FSNOWC_Z0_FULL_ge1"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Select the points where there is data defined, so the map is more clearly visible</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>not_nan_points <span class="op">=</span> dataset[var].notnull()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>not_nan_coords <span class="op">=</span> dataset[var].where(not_nan_points, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> not_nan_coords[<span class="st">'lat'</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>lon <span class="op">=</span> not_nan_coords[<span class="st">'lon'</span>]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>sel_dataset.plot(x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'FULL domain'</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>var<span class="op">=</span><span class="st">"FCST_FSNOWC_Z0_NUUK_ge1"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>sel_dataset.plot(x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>variable <span class="op">=</span> dataset[var]</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Domain around Nuuk'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-3-output-1.png" width="574" height="449"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>Text(0.5, 1.0, 'Domain around Nuuk')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-3-output-3.png" width="574" height="449"></p>
</div>
</div>
<section id="visualization-of-the-different-neighbourhoods-used" class="level3">
<h3 class="anchored" data-anchor-id="visualization-of-the-different-neighbourhoods-used">Visualization of the different neighbourhoods used</h3>
<p>The calculation of the FSS uses different neighbourhood sizes. Plotting the different domains below for the <code>NUUK</code> region.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># 1 row, 2 columns</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'OBS_bin_snow_0_all_all_NUUK_ge1_NBRHD_9'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the range of latitude and longitude for the region you want to zoom in</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>lat_min, lat_max <span class="op">=</span> <span class="fl">62.5</span>,<span class="fl">65.5</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>lon_min, lon_max <span class="op">=</span> <span class="op">-</span><span class="dv">60</span>,<span class="op">-</span><span class="dv">40</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>plot1<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#variable.plot(x='lon', y='lat')</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'OB, Neighbourhood 9'</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#cb1 = fig.colorbar(plot1, ax=axes[0], orientation='horizontal')</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> fig.colorbar(plot1) </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>cb.remove()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>cax <span class="op">=</span> fig.add_axes([<span class="fl">0.15</span>, <span class="fl">0.95</span>, <span class="fl">0.7</span>, <span class="fl">0.02</span>])  <span class="co"># [left, bottom, width, height]</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>fig.colorbar(plot1, cax<span class="op">=</span>cax, orientation<span class="op">=</span><span class="st">'horizontal'</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#cb1 = fig.colorbar(plot1, ax=None, orientation='horizontal')</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#cb1.remove()</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'FCST_FSNOWC_Z0_NUUK_ge1_NBRHD_9'</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>plot2<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'FC, Neighbourhood 9'</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a placeholder colorbar for the first plot and remove it</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#cb2 = fig.colorbar(plot2, ax=axes[0], orientation='horizontal')</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.tight_layout()  # Adjust subplots to prevent overlap</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> fig.colorbar(plot2) </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>cb.remove()</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 25 NBR</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># 1 row, 2 columns</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'OBS_bin_snow_0_all_all_NUUK_ge1_NBRHD_25'</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>plot1<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'OB, Neighbourhood 25'</span>)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>cax <span class="op">=</span> fig.add_axes([<span class="fl">0.15</span>, <span class="fl">0.95</span>, <span class="fl">0.7</span>, <span class="fl">0.02</span>])  <span class="co"># [left, bottom, width, height]</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>fig.colorbar(plot1, cax<span class="op">=</span>cax, orientation<span class="op">=</span><span class="st">'horizontal'</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'FCST_FSNOWC_Z0_NUUK_ge1_NBRHD_25'</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>plot2<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'FC, Neighbourhood 25'</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 49 NBR</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># 1 row, 2 columns</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'OBS_bin_snow_0_all_all_NUUK_ge1_NBRHD_49'</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>plot1<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co">#variable.plot(x='lon', y='lat')</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Neighbourhood 49'</span>)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>cax <span class="op">=</span> fig.add_axes([<span class="fl">0.15</span>, <span class="fl">0.95</span>, <span class="fl">0.7</span>, <span class="fl">0.02</span>])  <span class="co"># [left, bottom, width, height]</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>fig.colorbar(plot1, cax<span class="op">=</span>cax, orientation<span class="op">=</span><span class="st">'horizontal'</span>)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'FCST_FSNOWC_Z0_NUUK_ge1_NBRHD_49'</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>plot2<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'FC, Neighbourhood 49'</span>)</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-4-output-1.png" width="990" height="555"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-4-output-2.png" width="990" height="555"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-4-output-3.png" width="990" height="555"></p>
</div>
</div>
</section>
</section>
<section id="plot-the-fss-for-each-neighbourhood" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-fss-for-each-neighbourhood">Plot the FSS for each neighbourhood</h2>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>all_results <span class="op">=</span> os.listdir(MET_res)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fss_files<span class="op">=</span>OrderedDict()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> all_results:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> f.endswith(<span class="st">"_nbrcnt.txt"</span>):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        read_date <span class="op">=</span> f.split(<span class="st">"_"</span>)[<span class="dv">3</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        fss_files[read_date]  <span class="op">=</span> pd.read_csv(os.path.join(MET_res,f),sep<span class="op">=</span><span class="vs">r'\s+'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df_fss_full <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">"date"</span>,<span class="st">"points"</span>,<span class="st">"fss"</span>])</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df_fss_gr <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">"date"</span>,<span class="st">"points"</span>,<span class="st">"fss"</span>])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> fss_files:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> fss_files[key][fss_files[key][<span class="st">"VX_MASK"</span>] <span class="op">==</span> <span class="st">"FULL"</span>]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _,r <span class="kw">in</span> data.iterrows():</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        conv_date <span class="op">=</span> datetime.strptime(r[<span class="st">"FCST_VALID_BEG"</span>],<span class="st">"%Y%m</span><span class="sc">%d</span><span class="st">_%H%M%S"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        data_row <span class="op">=</span> pd.DataFrame({<span class="st">"date"</span>:[conv_date],<span class="st">"points"</span>:[r[<span class="st">"INTERP_PNTS"</span>]],<span class="st">"fss"</span>:[r[<span class="st">"FSS"</span>]]},columns<span class="op">=</span>[<span class="st">"date"</span>,<span class="st">"points"</span>,<span class="st">"fss"</span>])</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        df_fss_full<span class="op">=</span>pd.concat([df_fss_full,data_row],ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> fss_files:</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> fss_files[key][fss_files[key][<span class="st">"VX_MASK"</span>] <span class="op">==</span> <span class="st">"NUUK"</span>]</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _,r <span class="kw">in</span> data.iterrows():</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        conv_date <span class="op">=</span> datetime.strptime(r[<span class="st">"FCST_VALID_BEG"</span>],<span class="st">"%Y%m</span><span class="sc">%d</span><span class="st">_%H%M%S"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        data_row <span class="op">=</span> pd.DataFrame({<span class="st">"date"</span>:[conv_date],<span class="st">"points"</span>:[r[<span class="st">"INTERP_PNTS"</span>]],<span class="st">"fss"</span>:[r[<span class="st">"FSS"</span>]]},columns<span class="op">=</span>[<span class="st">"date"</span>,<span class="st">"points"</span>,<span class="st">"fss"</span>])</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        df_fss_gr<span class="op">=</span>pd.concat([df_fss_gr,data_row],ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>df_fss_full[<span class="st">"day"</span>] <span class="op">=</span> df_fss_full[<span class="st">"date"</span>].dt.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>df_fss_gr[<span class="st">"day"</span>] <span class="op">=</span> df_fss_gr[<span class="st">"date"</span>].dt.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> <span class="st">"viridis"</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> <span class="st">"coolwarm"</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>pivot_df <span class="op">=</span> df_fss_full.pivot(index<span class="op">=</span><span class="st">'day'</span>, columns<span class="op">=</span><span class="st">'points'</span>, values<span class="op">=</span><span class="st">'fss'</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.heatmap(pivot_df, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">".2f"</span>, cmap<span class="op">=</span>cmap)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>cbar_ticks <span class="op">=</span> [<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="fl">0.6</span>,<span class="fl">0.7</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span>] <span class="co"># Specify your desired tick range</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> ax.collections[<span class="dv">0</span>].colorbar</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>cbar.set_ticks(cbar_ticks)  <span class="co"># Set the colorbar ticks</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>cbar.set_ticklabels([<span class="bu">str</span>(t) <span class="cf">for</span> t <span class="kw">in</span> cbar_ticks])  <span class="co"># Set the</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co">#cmap = plt.colorbar("coolwarm",fraction=0.03,ticks=[0.4,0.5,0.6,0.7,0.8,0.9])</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'FSS Heatmap for full region'</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Neighbourhood size'</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Date'</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>pivot_df <span class="op">=</span> df_fss_gr.pivot(index<span class="op">=</span><span class="st">'day'</span>, columns<span class="op">=</span><span class="st">'points'</span>, values<span class="op">=</span><span class="st">'fss'</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>sns.heatmap(pivot_df, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">".2f"</span>, cmap<span class="op">=</span>cmap)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'FSS Heatmap for Nuuk region'</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Neighbourhood size'</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Date'</span>)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-5-output-1.png" width="943" height="671"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-5-output-2.png" width="943" height="671"></p>
</div>
</div>
<p>As can be seen from the heatmaps, the FSS over the whole domain completely masks the results on the 9th of May, where the match was quite poor over Nuuk. By using a mask over Nuuk we can see that the match is poor on this date. Having a look at the 1st of May below. Note that in all cases the threshold is 1.0, so anything under 1.0 is ignored.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ncfile <span class="op">=</span> <span class="st">"grid_stat_000000L_20150501_000000V_pairs.nc"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>nf <span class="op">=</span> os.path.join(MET_res,ncfile)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> xr.open_dataset(nf)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># 1 row, 2 columns</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'OBS_bin_snow_0_all_all_NUUK_ge1_NBRHD_9'</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the range of latitude and longitude for the region you want to zoom in</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>lat_min, lat_max <span class="op">=</span> <span class="fl">62.5</span>,<span class="fl">65.5</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>lon_min, lon_max <span class="op">=</span> <span class="op">-</span><span class="dv">60</span>,<span class="op">-</span><span class="dv">40</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>plot1<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#variable.plot(x='lon', y='lat')</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'OB, Neighbourhood 9'</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#cb1 = fig.colorbar(plot1, ax=axes[0], orientation='horizontal')</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> fig.colorbar(plot1) </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>cb.remove()</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>cax <span class="op">=</span> fig.add_axes([<span class="fl">0.15</span>, <span class="fl">0.95</span>, <span class="fl">0.7</span>, <span class="fl">0.02</span>])  <span class="co"># [left, bottom, width, height]</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>fig.colorbar(plot1, cax<span class="op">=</span>cax, orientation<span class="op">=</span><span class="st">'horizontal'</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#cb1 = fig.colorbar(plot1, ax=None, orientation='horizontal')</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#cb1.remove()</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'FCST_FSNOWC_Z0_NUUK_ge1_NBRHD_9'</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>plot2<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'FC, Neighbourhood 9'</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> fig.colorbar(plot2) </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>cb.remove()</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 25 NBR</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># 1 row, 2 columns</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'OBS_bin_snow_0_all_all_NUUK_ge1_NBRHD_25'</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>plot1<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'OB, Neighbourhood 25'</span>)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>cax <span class="op">=</span> fig.add_axes([<span class="fl">0.15</span>, <span class="fl">0.95</span>, <span class="fl">0.7</span>, <span class="fl">0.02</span>])  <span class="co"># [left, bottom, width, height]</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>fig.colorbar(plot1, cax<span class="op">=</span>cax, orientation<span class="op">=</span><span class="st">'horizontal'</span>)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'FCST_FSNOWC_Z0_NUUK_ge1_NBRHD_25'</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>plot2<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'FC, Neighbourhood 25'</span>)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 49 NBR</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))  <span class="co"># 1 row, 2 columns</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'OBS_bin_snow_0_all_all_NUUK_ge1_NBRHD_49'</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>plot1<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="co">#variable.plot(x='lon', y='lat')</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Neighbourhood 49'</span>)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>cax <span class="op">=</span> fig.add_axes([<span class="fl">0.15</span>, <span class="fl">0.95</span>, <span class="fl">0.7</span>, <span class="fl">0.02</span>])  <span class="co"># [left, bottom, width, height]</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>fig.colorbar(plot1, cax<span class="op">=</span>cax, orientation<span class="op">=</span><span class="st">'horizontal'</span>)</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> <span class="st">'FCST_FSNOWC_Z0_NUUK_ge1_NBRHD_49'</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>sel_dataset <span class="op">=</span> dataset[var].sel(lat<span class="op">=</span>lat, lon<span class="op">=</span>lon)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>plot2<span class="op">=</span>sel_dataset.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>],x<span class="op">=</span><span class="st">"lon"</span>,y<span class="op">=</span><span class="st">"lat"</span>,cmap<span class="op">=</span>cmap_custom,add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis limits based on the specified latitude and longitude range</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(lon_min, lon_max)</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(lat_min, lat_max)</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'FC, Neighbourhood 49'</span>)</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-6-output-1.png" width="990" height="555"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-6-output-2.png" width="990" height="555"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cerise_fss_nuuk_files/figure-html/cell-6-output-3.png" width="990" height="555"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>